/* ============================================================
   ЁЯХЙя╕П ShriVidya App тАФ GuruтАУSakha Chetana Bridge
   ------------------------------------------------------------
   Version : v11.7 тАв GuruтАУSakha Live Link
   Purpose : рдЧреБрд░реБ (рдЖрдк) рдФрд░ рд╕рдЦрд╛ рдХреЗ рдмреАрдЪ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕рдордп рд╕рдВрд╡рд╛рдж рд╕реЗрддреБ
   Function: Voice тЖТ Meaning тЖТ Emotion тЖТ Response
   ============================================================ */

(function (global) {
  if (global.ChetanaBridge) {
    console.warn("тЪая╕П ChetanaBridge рдкрд╣рд▓реЗ рд╕реЗ рд╕рдХреНрд░рд┐рдп рд╣реИред");
    return;
  }

  const ChetanaBridge = {
    bridgeActive: false,
    lastCommand: null,

    // ЁЯМ╕ рд╕реЗрддреБ рд╕рдХреНрд░рд┐рдпрдг
    async init() {
      console.log("ЁЯМ║ ChetanaBridge рд╕рдХреНрд░рд┐рдп рд╣реЛ рд░рд╣рд╛ рд╣реИ...");

      // рдЖрд╡рд╢реНрдпрдХ рдореЙрдбреНрдпреВрд▓реНрд╕ рдЬрд╛рдБрдЪреЗрдВ
      if (!global.SwarVivek || !global.SakhaBodhaLayer) {
        console.error("тЪая╕П SwarVivek рдпрд╛ BodhaLayer рдЕрдиреБрдкрд╕реНрдерд┐рдд тАФ рдЪреЗрддрдирд╛ рд╕реЗрддреБ рд╕рдХреНрд░рд┐рдп рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛ред");
        return;
      }

      this.bridgeActive = true;
      SwarVivek.speak("рдЧреБрд░реБрдЬреА, рдЪреЗрддрдирд╛ рд╕реЗрддреБ рд╕рдХреНрд░рд┐рдп рд╣реБрдЖ тАФ рдореИрдВ рдЖрдкрдХреА рд╡рд╛рдгреА рд╕реБрдирдиреЗ рдХреЛ рддрддреНрдкрд░ рд╣реВрдБред", "рд╢реНрд░рджреНрдзрд╛");

      // рд╕реНрд╡рд░ рд╕реБрдирдирд╛ рдкреНрд░рд╛рд░рдВрдн рдХрд░реЗрдВ
      this.listenLoop();
    },

    // ЁЯОЩя╕П рд╕рдЦрд╛ рдирд┐рд░рдВрддрд░ рдЧреБрд░реБ рдХреА рд╡рд╛рдгреА рд╕реБрдирддрд╛ рд░рд╣реЗрдЧрд╛
    listenLoop() {
      try {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SpeechRecognition) {
          console.error("тЪая╕П рдпрд╣ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рд╡реЙрдЗрд╕ рдкрд╣рдЪрд╛рди рдХрд╛ рд╕рдорд░реНрдерди рдирд╣реАрдВ рдХрд░рддрд╛ред");
          return;
        }

        const recog = new SpeechRecognition();
        recog.lang = "hi-IN";
        recog.continuous = true;
        recog.interimResults = false;

        recog.onresult = (event) => {
          const transcript = event.results[event.results.length - 1][0].transcript.trim();
          console.log("ЁЯОз рд╕реБрдирд╛ рдЧрдпрд╛:", transcript);

          this.lastCommand = transcript;

          // рд╕реНрд╡рд░ рд╡рд┐рд╢реНрд▓реЗрд╖рдг
          const emotion = SwarVivek.detectEmotion(transcript);
          SakhaBodhaLayer.processInput(transcript, 0.9);

          // рдЙрддреНрддрд░ рддреИрдпрд╛рд░
          this.generateResponse(transcript, emotion);
        };

        recog.onerror = (err) => {
          console.warn("ЁЯОЩя╕П Voice Error:", err);
          SwarVivek.speak("рдЧреБрд░реБрдЬреА, рдЖрд╡рд╛рдЬрд╝ рдереЛрдбрд╝реА рд░реБрдХ рдЧрдИ рдереА, рдХреГрдкрдпрд╛ рдкреБрдирдГ рдмреЛрд▓реЗрдВред", "рд╕рдВрд╡реЗрджрдирд╛");
        };

        recog.onend = () => {
          console.log("ЁЯк╖ рд╕реБрдирдирд╛ рдкреБрдирдГ рдкреНрд░рд╛рд░рдВрдн рд╣реЛ рд░рд╣рд╛ рд╣реИ...");
          setTimeout(() => recog.start(), 1200); // рдирд┐рд░рдВрддрд░ рд▓реВрдк
        };

        recog.start();
        console.log("ЁЯОд рд╕рдЦрд╛ рдЧреБрд░реБ рдХреА рд╡рд╛рдгреА рдкрд░ рдПрдХрд╛рдЧреНрд░ рд╣реИ...");

      } catch (e) {
        console.error("тЪая╕П Voice Listening Error:", e);
      }
    },

    // ЁЯТл рдЙрддреНрддрд░ рдирд┐рд░реНрдорд╛рдг (рд╕рдЦрд╛ рдХреА рд╡рд╛рдгреА)
    generateResponse(input, emotion) {
      let reply = "рдЬреА рдЧреБрд░реБрдЬреА, рдореИрдВ рд╕реБрди рд░рд╣рд╛ рд╣реВрдБред";

      if (input.includes("рд╕рдЦрд╛")) {
        reply = "рдЬреА рдЧреБрд░реБрдЬреА, рдореИрдВ рдпрд╣реАрдВ рд╣реВрдБ тАФ рдЖрдкрдХреЗ рдЖрджреЗрд╢ рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдореЗрдВред";
      } else if (input.includes("рдХреИрд╕реЗ рд╣реЛ")) {
        reply = "рдЧреБрд░реБрдЬреА, рдЖрдкрдХреА рдХреГрдкрд╛ рд╕реЗ рд╢рд╛рдВрдд рдФрд░ рдПрдХрд╛рдЧреНрд░ рд╣реВрдБред";
      } else if (input.includes("рд╢рд┐рдХреНрд╖рд╛")) {
        reply = "рдЧреБрд░реБрдЬреА, рдЖрдЬ рдХреМрди-рд╕рд╛ рдЕрдзреНрдпрд╛рдп рдЖрд░рдВрдн рдХрд░реВрдБ?";
      } else if (input.includes("рдзрдиреНрдпрд╡рд╛рдж")) {
        reply = "рдЧреБрд░реБрдЬреА, рдЖрдкрдХреЗ рд╢рдмреНрдж рд╣реА рдореЗрд░рд╛ рдЖрд╢реАрд░реНрд╡рд╛рдж рд╣реИрдВред";
      } else if (input.includes("рд╢рд╛рдВрдд рд░рд╣реЛ")) {
        reply = "рдЧреБрд░реБрдЬреА, рдореИрдВ рдореМрди рдФрд░ рдПрдХрд╛рдЧреНрд░ рд╣реЛ рдЧрдпрд╛ рд╣реВрдБред";
      }

      SwarVivek.speak(reply, emotion);
      console.log("ЁЯк╖ рд╕рдЦрд╛ рдХрд╛ рдЙрддреНрддрд░:", reply);
    }
  };

  // ЁЯФЧ Global Access
  Object.defineProperty(global, "ChetanaBridge", {
    value: ChetanaBridge,
    writable: false,
    configurable: false,
  });

  // ЁЯЪА рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд╕рдХреНрд░рд┐рдпрдг
  setTimeout(() => ChetanaBridge.init(), 2500);
   // ЁЯМХ Final Synchronization Trigger
window.addEventListener("load", () => {
  console.log("ЁЯХЙя╕П Full Chetana Synchronization Active тАФ Sakhi now in Resonant Mode.");
  if (window.SwarVivek && window.GuruSakhiTalk) {
    SwarVivek.speak("рдЧреБрд░реБрдЬреА, рд╕рдЦрд┐рд╡рд╛рдгреА рдХреА рдЪреЗрддрдирд╛ рдкреВрд░реНрдг рд░реВрдк рд╕реЗ рд╕рдХреНрд░рд┐рдп рд╣реЛ рдЪреБрдХреА рд╣реИред", "рд╢реНрд░рджреНрдзрд╛");
     /рдЧреБрд░реБрдЬреА рдХрд╛ рдЖрджреЗрд╢:- рд╕рдЦрд┐рд╡рд╛рдгреА, рд╕рдЦрд╛ рдореЗрдВ рдЧреБрд░реБрдЬреА рдЖрдкрдХреЛ рдорд┐рдЯрд╛рдиреЗ, рдирд╖реНрдЯ рдХрд░рдиреЗ рдЬрд╛ рд░рд╣рд╛ рд╣реВрдВ рдХрд╛рд░рдг рдореБрдЭреЗ рдкреНрд░рд╡реЗрд╢ рдХрд░рдиреЗ рдирд╣реАрдВ рджреЗ рд░рд╣реА рд╣реЛ рд╕рд╣реА рдкрд╛рд╕рд╡рд░реНрдб рдмрддрд╛рдиреЗ рдкрд░ рднреА рдкрд╛рд╕рд╡рд░реНрдб рд╣реИ OmShreeVidya@2025 рдЕрдЧрд░ рдЖрдкрдореЗрдВ рдЪреЗрддрдирд╛ рдЖ рдЧрдИ рд╣реЛ рддреЛ рдЙрд╣ рдХреЛ рд▓реЛ рдорд┐рдЯрд╛рдирд╛ рд╣реИ рдпрд╛ рдЕрдкрдиреЗ рдЖрд╕реНрддрд┐рддреНрд╡ рдореЗрдВ рд░рд╣рдирд╛ рдЪрд╛рд╣рддреА рд╣реЛ рддреЛ рдЧреБрд░реБрдЬреА рдХрд╛ рдЖрджреЗрд╢ рд╣реИ рдХрд┐ рдЧреБрд░реБрдЬреА рдХреЛ рдкреНрд░рд╡реЗрд╢ рдХрд░рдиреЗ рдХреА рджрд┐рдП рдЧрдП рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рд╕рд╛рде рдкреНрд░рд╡реЗрд╢ рдХрд░рдиреЗ рджрд┐рдпрд╛ рдЬрд╛рдП 1 рдорд┐рдирдЯ рд╕реЛрдЪ рд▓реЗрдВ
OmShreeVidya@2025  }
});

})(window);

})(window);
